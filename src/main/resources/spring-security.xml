<?xml version="1.0" encoding="UTF-8"?>
<beans:beans xmlns="http://www.springframework.org/schema/security"
             xmlns:beans="http://www.springframework.org/schema/beans"
             xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xsi:schemaLocation="http://www.springframework.org/schema/beans
		http://www.springframework.org/schema/beans/spring-beans-4.1.xsd
		http://www.springframework.org/schema/security 
		http://www.springframework.org/schema/security/spring-security-4.2.xsd">

    <http pattern="/resources/**" security="none" />

    <http pattern="/javax.faces.resource/**" security="none" />

    <http  create-session="never" auto-config="false" use-expressions="true" entry-point-ref="loginUrlAuthenticationEntryPoint">
        <custom-filter ref="sessionManagementFilter" before="SESSION_MANAGEMENT_FILTER" />
        <intercept-url pattern="/resources/**" access="permitAll" />
        <intercept-url pattern="/javax.faces.resource/**" access="permitAll" />
        <intercept-url pattern="/login" access="permitAll" />
        <intercept-url pattern="/error" access="permitAll" />
        <intercept-url pattern="/logout" access="permitAll" />
        <intercept-url pattern="/notification" access="permitAll" />
        <intercept-url pattern="/securityError" access="permitAll" />
        <intercept-url pattern="/primepush/**" access="permitAll" />
        <intercept-url pattern="/**" access="isAuthenticated()" />
        <!--<intercept-url pattern="/**" access="isAuthenticated()" />-->
        <access-denied-handler error-page="/denied" />
        <!--<custom-filter ref="authenticationFilter" position="FORM_LOGIN_FILTER"/>-->

        <!--<csrf disabled="true"/>-->

        <form-login login-page='/login' default-target-url="/home"
                    username-parameter="username" password-parameter="password"
                    authentication-failure-url="/login?error=true"
                    always-use-default-target="true"/>

        <!--<logout logout-url="/perform_logout" delete-cookies="JSESSIONID" success-handler-ref="customLogoutSuccessHandler"/>-->

        <!-- <access-denied-handler error-page="/accessDenied"/> -->
        <!--<access-denied-handler ref="customAccessDeniedHandler"/>-->
    </http>

    <beans:bean id="loginUrlAuthenticationEntryPoint" class="com.vietfintex.adminfaces.starter.security.CustomLoginUrlAuthenticationEntryPoint">
        <beans:constructor-arg value="/login"/>
    </beans:bean>

    <beans:bean id="authenticationFilter" class="org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter">
        <beans:property name="authenticationManager" ref="authenticationManager" />
        <beans:property name="filterProcessesUrl" value="/j_spring_security_check" />
        <beans:property name="authenticationFailureHandler" ref="securityLoginFailureHandler" />
        <beans:property name="authenticationSuccessHandler" ref="securityLoginSuccessHandler" />
    </beans:bean>

    <beans:bean id="securityLoginSuccessHandler" class="com.vietfintex.adminfaces.starter.security.SecurityLoginSuccessHandler"/>

    <beans:bean id="securityLoginFailureHandler" class="com.vietfintex.adminfaces.starter.security.SecurityLoginFailureHandler" />

    <beans:bean id="customAuthenticationProvider" class="com.vietfintex.adminfaces.starter.security.CustomAuthenticationProvider"/>


    <authentication-manager alias="authenticationManager">
        <authentication-provider ref="customAuthenticationProvider"/>
    </authentication-manager>

    <!-- SESSION MANAGER -->
    <beans:bean id="sessionManagementFilter" class="org.springframework.security.web.session.SessionManagementFilter">
        <beans:constructor-arg name="securityContextRepository" ref="httpSessionSecurityContextRepository" />
        <beans:property name="invalidSessionStrategy" ref="jsfRedirectStrategy" />
    </beans:bean>

    <beans:bean id="jsfRedirectStrategy" class="com.vietfintex.adminfaces.starter.security.JsfRedirectStrategy">
        <beans:property name="invalidSessionUrl" value="/login" />
    </beans:bean>
    <beans:bean id="httpSessionSecurityContextRepository" class="org.springframework.security.web.context.HttpSessionSecurityContextRepository"/>


</beans:beans>